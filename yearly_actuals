import pandas as pd

def save_future_warranty_costs_all_months(df, months_list, output_filename='warranty_costs_future_summary.xlsx'):
    # Ensure datetime conversion for relevant columns
    df['DISPATCH_MONTH'] = pd.to_datetime(df['DISPATCH_MONTH'], format='%Y-%m')
    df['WARRANTY_MONTH'] = pd.to_datetime(df['WARRANTY_MONTH'], format='%Y-%m')

    with pd.ExcelWriter(output_filename, engine='xlsxwriter') as writer:
        for month in months_list:
            ref_date = pd.to_datetime(month, format='%Y-%m')
            start_date = ref_date - pd.DateOffset(months=60)

            # Filter dispatch months within last 60 months up to the reference month
            filtered_df = df[(df['DISPATCH_MONTH'] > start_date) & (df['DISPATCH_MONTH'] <= ref_date)]

            # Filter warranty months starting from the reference month onward
            future_df = filtered_df[filtered_df['WARRANTY_MONTH'] >= ref_date].copy()

            # Aggregate warranty cost by warranty month
            summary = future_df.groupby('WARRANTY_MONTH')['WARRANTY_COST'].sum().reset_index()

            # Save only the summary dataframe to the sheet named as the month
            summary.to_excel(writer, sheet_name=month, index=False)

    print(f'Data saved in {output_filename}')

# Example usage:
# months = ['2023-01', '2023-02', '2023-03']
# save_future_warranty_costs_all_months(df, months)
